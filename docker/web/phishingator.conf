<VirtualHost *:80>
    ServerAdmin martin.sebela@cesnet.cz

    DocumentRoot ${APACHE_DOCUMENT_ROOT}

    OIDCProviderMetadataURL ${OIDC_METADATA_URL}
    OIDCProviderMetadataRefreshInterval 3600
    OIDCClientID ${OIDC_CLIENT_ID}
    OIDCClientSecret ${OIDC_CLIENT_SECRET}
    OIDCRemoteUserClaim uid
    OIDCScope "openid sub email uid"
    OIDCRedirectURI /oauth2callback
    OIDCCryptoPassphrase ${OIDC_CRYPTO_PASSPHRASE}
    OIDCPathAuthRequestParams acr_values=urn:cesnet:proxyidp:filter:eyJ2ZXIiOiIyIiwiYWxsb3dGZWVkcyI6eyJlZHVJRC5jeiI6eyJhbGxvd0lkUHMiOlsiaHR0cHM6Ly93aG9hbWkuY2VzbmV0LmN6L2lkcC9zaGliYm9sZXRoIl19fX0=

    <Location /oauth2callback>
        AuthType openid-connect
        Require valid-user
    </Location>

    <Location /portal/>
        AuthType openid-connect
        Require valid-user
    </Location>

    <Directory ${APACHE_DOCUMENT_ROOT}>
        Options Indexes FollowSymLinks
        AllowOverride All
        Require all granted
    </Directory>
</VirtualHost>
